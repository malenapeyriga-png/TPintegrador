//ACA PEGO TODO EL CODIGO QUE HAGO DSP LO ACOMODO EN .H Y CCP

#include <iostream>
#include <string>
#include <cstdlib>  // Para rand() y srand()
#include <ctime>    // Para time()
using namespace std;

//STRUCTS
struct MARCAS {
    int codMarca;
    string nombre;
};
MARCAS Marcas[10];
struct PRODUCTOS {
    int codProd;
    string nombreProd;
    float preVenta;
    float preCompra;
    int stock;
    int codMarca;
};
PRODUCTOS vProd[20];
struct FORMAPAGO{
    string codPago;
    string nombreFP;
    int porcentaje;
};
FORMAPAGO vFormaPago[5];
//VALIDACIONES

//validarCero 
int validarCero(int valor){
    int i;
    while (valor==0){
        cout<<"El valor ingresado no es válido, intentelo nuevamente"<< endl;
        cin>>valor;
    }
    return valor;
}
//validaCodMarca
int validaCodMarca(int valor){
        while (valor<1 || valor>10){
        cout<<"El valor ingresado no es válido, intentelo nuevamente"<< endl;
        cin>>valor;
    }
    return valor;
}
//validaString
string validaString(string valor){
    cin.ignore();
    
    while (valor==""){
        cout<<"El valor ingresado no es válido, intentelo nuevamente"<< endl;
        getline(cin,valor);
    }
    return valor;
}
//validaCodMarcaIngresado
int validaCodMarcaIngresado(int cod, MARCAS Marcas[], int tamProd, int tamMarcas) {
int i = 0;  
while (true){
for (i = 0; i<tamMarcas; i++) {
    if (cod==Marcas[i].codMarca) {
        return cod; 
    }
}
cout << "Código de marca no encontrado en el lote de marcas. Ingreselo nuevamente: ";
cin >> cod;
    }
}
//repetidosFP
string repetidosFP(string FP, FORMAPAGO vFormaPago[], int tamFP){
    while(true){

        for(int i = 0; i < tamFP; i++){
            if (FP == vFormaPago[i].codPago){
                cout << "Código de forma de pago ya guardado. Ingreselo nuevamente: ";
                cin >> FP;
                i = -1; // es importante para reiniciar el for
            }
        }
        //si no se repitió ningun codFP:
        return FP;
    }
}
//validarDistintosFP
string validarDistintosFP(string FP){
    while(true){
        if (FP=="EF" || FP == "MP"|| FP=="TR"||FP=="TC"||FP=="CT"){
            return FP;
        }
        else{
            cout<<"Código de forma de pago inválido, ingreselo nuevamente: ";
            cin>>FP;
            }
        }
}
//VALIDA CARGAS, VALIDA QUE SE HAYAN INGRESADO DATOS EN CADA VECTOR, VA DE LA MANO CON ingresoVentas. 
O sea se llama con un IF JUNTO A ingresoVentas
bool validaCargas(MARCAS Marcas[], int tamMarcas, PRODUCTOS vProd[], int tamProd, FORMAPAGO vFormaPago[], int tamFP) {
    // Validar marcas
    for (int i = 0; i < tamMarcas; i++) {
        if (Marcas[i].codMarca == 0) {
            cout << "Las marcas no fueron cargadas." << endl;
            return false;
        }
    }

    // Validar productos
    for (int i = 0; i < tamProd; i++) {
        if (vProd[i].codProd == 0) {
            cout << "Los productos no fueron cargados." << endl;
            return false;
        }
    }

    // Validar formas de pago
    for (int i = 0; i < tamFP; i++) {
        if (vFormaPago[i].codPago == "") {
            cout << "Las formas de pago no fueron cargadas." << endl;
            return false;
        }
    }

    return true;
}
//FUNCIONES PUNTO 1: buscarProd, burbuja y mostrarRecaudacion
//buscarProd
int buscarProd(PRODUCTOS vProd[], int tamProd, int codProd) {
    for (int i = 0; i < tamProd; i++) {
        if (vProd[i].codProd == codProd) {
            return i;   // i quiere decir que el codProd que el usuario ingresa SÍ ESTA cargado adentro de .codProd
        }
    }
    return -1; // No está
}

void burbuja(PRODUCTOS vProd[], int cantVendida[], int tamProd) {
    PRODUCTOS auxProd;   // Variable auxiliar para intercambiar productos
    int auxCantVendida;  // Variable auxiliar para intercambiar cantidades vendidas

    // Burbuja
    for (int i = 0; i < tamProd - 1; i++) {
        for (int j = 0; j < tamProd - i - 1; j++) {
            // Si la cantidad vendida del producto j es menor que la del producto j+1, los intercambiamos
            if (cantVendida[j] < cantVendida[j + 1]) {
                // Intercambiamos las cantidades vendidas
                auxCantVendida = cantVendida[j];
                cantVendida[j] = cantVendida[j + 1];
                cantVendida[j + 1] = auxCantVendida;

                // Intercambiamos los productos
                auxProd = vProd[j];
                vProd[j] = vProd[j + 1];
                vProd[j + 1] = auxProd;
            }
        }
    }
}
    // MOSTRAR RECAUDACION
void mostrarRecaudacion(PRODUCTOS vProd[], int tamProd,
                        float recaudacion[], int cantVendida[], float remanente[]) 
//los vectores de recaudacion y remanente tienen tamaño 20 xq acumulan la recaudacion y el remanente por cada producto. 
{
    cout <<"Recaudación por producto";

    for (int i = 0; i < tamProd; i++) {

        cout << "Producto: " << vProd[i].nombreProd
             << "Código: " << vProd[i].codProd
             << "Recaudación total: $" << recaudacion[i]
             << "Cantidad vendida: " << cantVendida[i]
             << "Stock remanente: " << remanente[i];
    }
}

FUNCIONES PUNTO 5 TOP 10 CLIENTES + SORTEO DE CUPONES:


// Función para seleccionar 3 ganadores aleatorios de max10[] y mostrar su cantidad de compras
//SE DESARROLLA ANTES QUE LAS DEMAS XQ SINO SALE ERROR QUE NO ESTÁ DECLARADA.
void cargarAleatorio(int max10[], int maxClientes[], int tam) {
    // Mostrar 3 números aleatorios del arreglo max10
    for (int i = 0; i < 3; i++) {
        int indice = rand() % tam;  // Generar un índice aleatorio entre 0 y tam-1
        cout << "Ganador/a del cupon de descuento " << i + 1 << ": Cliente " << max10[indice] << " - Compras: " << maxClientes[indice] << endl;
    }
}

// burbuja de mayor a menor usando una variable auxiliar
void burbuja(int nroCliente[], int clientes[]) {
    int auxCliente, auxCompras;
    
    for (int i = 0; i < 50 - 1; i++) {
        for (int j = 0; j < 50 - i - 1; j++) {
            if (clientes[j] < clientes[j + 1]) {
                auxCompras = clientes[j];
                clientes[j] = clientes[j + 1];
                clientes[j + 1] = auxCompras;

                // Intercambio de los números de cliente
                auxCliente = nroCliente[j];
                nroCliente[j] = nroCliente[j + 1];
                nroCliente[j + 1] = auxCliente;
            }
        }
    }
}
// los primeros 10 máximos de compras
void max(int clientes[], int nroCliente[]) {
    int max10[10];  //  10 clientes con más compras
    int maxClientes[10];  //las compras de los 10 máximos
    
    for (int i = 0; i < 10; i++) {
        max10[i] = nroCliente[i];       // nrocliente
        maxClientes[i] = clientes[i];   // Guardamos la cantidad de compras del cliente
    }

    // un for que recorra los indices de max10 y maxClientes
    cout << "TOP 10 clientes con más compras:" << endl;
    for (int i = 0; i < 10; i++) {
        cout << "Cliente " << max10[i] << " - Compras: " << maxClientes[i] << endl;
    }
    
    // Llamar a la función de sorteo para elegir 3 ganadores
    cargarAleatorio(max10, maxClientes, 10);  
}







//se pone & antes de solamente las variables ingresadas, NO de vectores, para que los valores se pasen por referencia 
void ingresoVentas(int &nroCompra, int &codProd, string &FP, int &cant,
                   int &codCliente, int &dia,
                   PRODUCTOS vProd[], int tamProd,
                   float recaudacion[], int cantVendida[],
                   float remanente[]) 
{
    while (true) {
        cout << "Ingrese el número de compra (0 para salir): ";
        cin >> nroCompra;
        if (nroCompra == 0) break;

        cout << "Ingrese el código del producto: ";
        cin >> codProd;

        int indiceProd = buscarProd(vProd, tamProd, codProd);

        if (indiceProd == -1) {
            cout << "Producto ino encontrado. Intente nuevamente.";
            continue;
        }

        cout << "Ingrese la forma de pago: ";
        cin >> FP;

        cout << "Ingrese la cantidad vendida: ";
        cin >> cant;

        // Acumular
        cantVendida[indiceProd] += cant;
        recaudacion[indiceProd] += cant * vProd[indiceProd].preVenta;
        remanente[indiceProd] = vProd[indiceProd].stock - cantVendida[indiceProd];

        cout << "Ingrese el código de cliente: ";
        cin >> codCliente;
        //PUNTO 5 TOP 10 SORTEO, EL VECTOR CLIENTES CUENTA LA CANT DE COMPRAS DE CADA CLIENTE,SUMA 1 XQ CADA CARGA ES UNA VENTA
        clientes[codCliente - 1]++;
        cout << "Ingrese el día (1-30): ";
        cin >> dia;
    }
}
//FUNCIONES CARGAR LOTES
//LOTE MARCAS
void cargarLoteMarcas(MARCAS Marcas[], int tamMarcas) {
    int i;
    for (i = 0; i < tamMarcas; i++) {
        tamMarcas=10;
        cout << "Ingrese el código de la marca: ";
        cin >> Marcas[i].codMarca;
        Marcas[i].codMarca = validarCero(Marcas[i].codMarca);
        Marcas[i].codMarca =validaCodMarca(Marcas[i].codMarca);
        cout << "Ingrese el nombre de la marca: ";
        cin.ignore();
        getline(cin, Marcas[i].nombre);
        Marcas[i].nombre = validaString(Marcas[i].nombre);
    }
}    
void mostrarLoteMarcas(MARCAS Marcas[], int tamMarcas){
    cout<< "Datos de las marcas" << endl<<endl;
    for(int i = 0; i < tamMarcas; i++){
        tamMarcas=10;
        cout<<Marcas[i].codMarca << " ---- ";
        cout<<Marcas[i].nombre<< endl<<endl;
    }
}

//LOTE PRODUCTOS
void cargarLoteProd(PRODUCTOS vProd[], int tamProd, MARCAS Marcas[], int tamMarcas) {
    int i;
    for (i = 0; i < tamProd; i++) {
        tamProd=20;
        cout << "Ingrese el código del producto: ";
        cin >> vProd[i].codProd;
        vProd[i].codProd= validarCero(vProd[i].codProd);
        cin.ignore(); 
        cout << "Ingrese el nombre del producto: ";
        cin.ignore();
        getline(cin, vProd[i].nombreProd);
        vProd[i].nombreProd = validaString(vProd[i].nombreProd);
        cout << "Ingrese el precio de venta del producto: ";
        cin >> vProd[i].preVenta;
        vProd[i].preVenta= validarCero(vProd[i].preVenta);
        cin.ignore(); 
        cout << "Ingrese el precio de compra del producto: ";
        cin >> vProd[i].preCompra;
        vProd[i].preCompra= validarCero(vProd[i].preCompra);
        cin.ignore(); 
        cout << "Ingrese el stock del producto: ";
        cin >> vProd[i].stock;
        vProd[i].stock= validarCero(vProd[i].stock);
        cin.ignore(); 
        cout << "Ingrese el codigo de marca: ";
        cin >> vProd[i].codMarca;
        vProd[i].codMarca= validarCero(vProd[i].codMarca);
        vProd[i].codMarca= validaCodMarcaIngresado(vProd[i].codMarca, Marcas, tamProd, tamMarcas);
        cin.ignore(); 
    }
}
//mostrar lote de productos
void mostrarLoteProd(PRODUCTOS vProd[], int tamProd){
    cout<< "Datos de los productos" << endl<<endl;
    for(int i = 0; i < tamProd; i++){
        tam=20;
        cout<<vProd[i].codProd << " ---- ";
        cout<<vProd[i].nombreProd<< endl<<endl;
        cout<<vProd[i].preVenta<< endl<<endl;
        cout<<vProd[i].preCompra<< endl<<endl;
        cout<<vProd[i].stock<< endl<<endl;
        cout<<vProd[i].codMarca<< endl<<endl;
    }
}
//LOTE FORMA DE PAGO
void cargarLoteFP(FORMAPAGO vFormaPago[], int tamFP) {
    int i;
    for (i = 0; i < tamFP; i++) {
        cout << "Ingrese el código de la forma de pago (EF,MP,TR,TC,CT): ";
        cin >> vFormaPago[i].codPago;
        vFormaPago[i].codPago = repetidosFP(vFormaPago[i].codPago, vFormaPago, i);
        vFormaPago[i].codPago = validarDistintosFP(vFormaPago[i].codPago);
        cin.ignore(); 
        cout << "Ingrese el nombre de la forma de pago ";
        getline(cin, vFormaPago[i].nombreFP);
        cout << "Ingrese el porcentaje de descuento (número negativo) o interés (número positivo) ";
        cin >> vFormaPago[i].porcentaje;
        }
    }
    //mostrar Lote FORMA DE PAGO
void mostrarLoteFP(FORMAPAGO vFormaPago[], int tam){
       cout<< "Datos de las formas de pago: " << endl<<endl;
    for(int i = 0; i < tam; i++){
        tamFP=5;
        cout<<vFormaPago[i].codPago << " ---- ";
        cout<<vFormaPago[i].nombreFP<< endl<<endl;
        cout<<vFormaPago[i].porcentaje<< endl<<endl;
        }
    }
//MOSTRAR REPORTES

int mostrarReportes() {
    cout << "Mostrar reportes: " << endl;
    cout << "1. Recaudación por producto." << endl;
    cout << "2. Porcentaje de ventas por forma de pago." << endl;
    cout << "3. Ventas por marca y forma de pago." << endl;
    cout << "4. Productos sin ventas." << endl;
    cout << "5. TOP 10 clientes + sorteo de cupones." << endl;
    cout << "6. Volver al menú principal." << endl;
    cout << "Ingrese una opción: ";

    int opcion;
    cin >> opcion;

    return opcion;
}
void ejecutarReporte(int opcion) {

    switch(opcion) {

        case 1:
            cout << "Recaudación por producto." << endl;
            // FUNCION DE Recaudación por producto
            break;
        case 2:
            cout << "Porcentaje de ventas por forma de pago." << endl;
            // FUNCION Porcentaje de ventas por forma de pago.
            break;
        case 3:
            cout << "Ventas por marca y forma de pago." << endl;
            // FUNCION "Ventas por marca y forma de pago."
            break;
        case 4:
            cout << "Productos sin ventas." << endl;
            // FUNCION Productos sin ventas." 
            break;
        case 5:
            cout << "TOP 10 clientes + sorteo de cupones." << endl;
            // FUNCION "TOP 10 clientes + sorteo de cupones.
            break;
        case 6:
            cout << "Salir" << endl;
            break;
    }
}
void IniciarMenu() {
    bool salir = false;
    int opcion;

    while (!salir) {
      opcion = mostrarReportes();
      ejecutarReporte(opcion);
        if (opcion == 6)
            salir = true;
    }
}
//ingresoVentas
void ingresoVentas(int &nroCompra, int &codProd, string &FP, int &cant, int &codCliente, int &dia) {
    while (true) {
        cout << "Ingrese el número de compra (0 para salir): ";
        cin >> nroCompra;
        if (nroCompra == 0) break;

        cout << "Ingrese el código del producto: ";
        cin >> codProd;
        int indiceProd = buscarProd(vProd, tamProd, codProd);
        if (indiceProd == -1) {
            cout << "Producto no encontrado. Intente nuevamente.";
            continue;
        }

        cout << "Ingrese la forma de pago: ";
        cin >> FP;
        cout << "Ingrese la cantidad vendida: ";
        cin >> cant;
        // Acumular
        cantVendida[indiceProd] += cant;
        recaudacion[indiceProd] += cant * vProd[indiceProd].preVenta;
        remanente[indiceProd] = vProd[indiceProd].stock - cantVendida[indiceProd];

        cout << "Ingrese el código de cliente: ";
        cin >> codCliente;
        cout << "Ingrese el día de la venta (1 a 30): ";
        cin >> dia;
    }
}


//LLAMO FUNCIONES DE CARGA DE LOTES EN MAIN y vectores
int main() {
     int tamMarcas = 10;
    int tamProd = 20;
    int tamFP = 5;

    //marcas
    MARCAS Marcas[10]; 
    cargarLoteMarcas(vMarcas, 10);
    mostrarLoteMarcas(vMarcas, 10);
    
    //PRODUCTOS
    PRODUCTOS vProd[20]; 
    cargarLoteProd(vProd, 20, Marcas, 10);
    
  //FORMA DE PAGO
  FORMAPAGO vFormaPago[5];
  cargarLoteFP(vFormaPago, 5);
    mostrarLoteFP(vFormaPago, 5);

//MOSTRAR REPORTE 
  IniciarMenu();
    return 0;

//validaCargas e ingresoVentas, se llaman las dos juntas!!
// if validaCargas es true, entonces ejecute la funcion de ingresoVentas.
    if (validaCargas(Marcas, tamMarcas, vProd, tamProd, vFormaPago, tamFP)) {
        ingresoVentas((nroCompra, codProd, FP, cant, codCliente, dia,
                      vProd, tamProd, recaudacion, cantVendida, remanente););
    } else {
        cout << "Primero cargue todas las marcas, productos y formas de pago." << endl;
    }
}

//PUNTO 1 RECAUDACION
float recaudacion[20] = {0};
    float remanente[20] = {0};
    int cantVendida[20] = {0};
//agrego burbuja
     burbuja(vProd, cantVendida, 5);
 mostrarRecaudacion(vProd, tamProd, recaudacion, cantVendida, remanente);

//PUNTO 5 TOP 10 MAXIMO Y SORTEO:
srand(time(0)); // Inicializamos el generador de números aleatorios
    //IMPORTANTE: Para aletorio si o si incluimos arriba de todo como se incluye
    //using namespacestd, de la misma forma ponemos #include <cstdlib>  // Para rand() y srand()
//#include <ctime>    // Para time()

int clientes[50] = {0};  // cantidad de compras de cada cliente
int nroCliente[50];  //  códigos de cliente, es el codCliente que el usuario ingresa
 // Inicializamos los nroCliente o sea codCliente de los clientes
    for (int i = 0; i < 50; i++) {
        nroCliente[i] = i + 1;  // Asignamos el código de cliente (1 a 50), se le suma 1 xq el vector arranca en cero
    }
//BURBUJA
    burbuja(nroCliente, clientes);

// MOSTRAR primeros 10 máximos
max(clientes, nroCliente);
FIN DEL PUNTO 5
